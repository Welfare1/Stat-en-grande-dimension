<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Amed BAH">

<title>Comparaison de deux approches PCR pour données mixtes: Analyse comparative FAMD-PCR vs PCR Classique</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="comparaison_PCR_cat_vs_num_files/libs/clipboard/clipboard.min.js"></script>
<script src="comparaison_PCR_cat_vs_num_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="comparaison_PCR_cat_vs_num_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="comparaison_PCR_cat_vs_num_files/libs/quarto-html/popper.min.js"></script>
<script src="comparaison_PCR_cat_vs_num_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="comparaison_PCR_cat_vs_num_files/libs/quarto-html/anchor.min.js"></script>
<link href="comparaison_PCR_cat_vs_num_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="comparaison_PCR_cat_vs_num_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="comparaison_PCR_cat_vs_num_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="comparaison_PCR_cat_vs_num_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="comparaison_PCR_cat_vs_num_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Comparaison de deux approches PCR pour données mixtes: Analyse comparative FAMD-PCR vs PCR Classique</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Amed BAH </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="objectif-et-méthodologie" class="level2">
<h2 class="anchored" data-anchor-id="objectif-et-méthodologie">Objectif et Méthodologie</h2>
<p>Comparer deux approches pour la Régression sur Composantes Principales (PCR) sur données mixtes (numériques + catégorielles) pour une cible catégorielle (classification binaire ou multiclasse).</p>
<p><strong>Approche 1 (FAMD-PCR):</strong> - Réduction de dimension non supervisée via FAMD (Factor Analysis of Mixed Data) - La variable cible y reste catégorielle (pas d’encodage manuel) - Classification : régression logistique sur les composantes principales extraites par FAMD</p>
<p><strong>Approche 2 (Classique - PCR Numérique):</strong> - Encodage manuel (get_dummies) des variables catégorielles (y comprise) - PCA sur X encodé - Classification : régression logistique sur les composantes principales</p>
<p><strong>Note sur l’implémentation:</strong> Cette analyse utilise une implémentation simplifiée de FAMD basée sur les packages R de base pour garantir la reproductibilité. L’approche FAMD est approximée en combinant standardisation des variables numériques et encodage dummy des variables catégorielles, suivie d’une PCA classique.</p>
</section>
<section id="chargement-des-librairies-et-préparation-des-données" class="level2">
<h2 class="anchored" data-anchor-id="chargement-des-librairies-et-préparation-des-données">1. Chargement des librairies et préparation des données</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Charger les packages de base disponibles dans R</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)     <span class="co"># Pour prcomp, glm</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)      <span class="co"># Pour LDA (optionnel)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction pour installer les packages manquants de façon gracieuse</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>install_if_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg) {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">try</span>({</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">install.packages</span>(pkg, <span class="at">repos =</span> <span class="st">"https://cloud.r-project.org/"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Essayer d'installer les packages nécessaires</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">install_if_missing</span>(<span class="st">"FactoMineR"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier la disponibilité de FactoMineR pour FAMD</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>use_factominer <span class="ot">&lt;-</span> <span class="fu">require</span>(<span class="st">"FactoMineR"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>use_factominer) {</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"FactoMineR non disponible - utilisation d'une implémentation simplifiée</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12311</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="création-dun-jeu-de-données-mixte" class="level3">
<h3 class="anchored" data-anchor-id="création-dun-jeu-de-données-mixte">Création d’un jeu de données mixte</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Paramètres du jeu de données</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">72</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>p_num <span class="ot">&lt;-</span> <span class="dv">50</span>     <span class="co"># Variables numériques (réduit pour faciliter les tests)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>p_cat <span class="ot">&lt;-</span> <span class="dv">5</span>      <span class="co"># Variables catégorielles</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Génération des variables numériques</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12311</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>X_num <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n <span class="sc">*</span> p_num), n, p_num)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X_num) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Num_"</span>, <span class="dv">1</span><span class="sc">:</span>p_num)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Génération des variables catégorielles</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>X_cat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cat_1 =</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>))),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cat_2 =</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.4</span>))),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cat_3 =</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>))),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cat_4 =</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Type1"</span>, <span class="st">"Type2"</span>, <span class="st">"Type3"</span>, <span class="st">"Type4"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cat_5 =</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Group1"</span>, <span class="st">"Group2"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.3</span>)))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable cible binaire</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"ALL"</span>, <span class="st">"AML"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.42</span>, <span class="fl">0.58</span>)))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du dataframe complet</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>df_mixed <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">data.frame</span>(X_num), X_cat, <span class="at">Y =</span> y)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dimensions du jeu de données mixte:"</span>, <span class="fu">dim</span>(df_mixed), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dimensions du jeu de données mixte: 72 56 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables numériques:"</span>, p_num, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables numériques: 50 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables catégorielles:"</span>, p_cat, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables catégorielles: 5 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Répartition de la variable cible:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Répartition de la variable cible:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(df_mixed<span class="sc">$</span>Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
ALL AML 
 28  44 </code></pre>
</div>
</div>
</section>
</section>
<section id="approche-1-famd-pcr" class="level2">
<h2 class="anchored" data-anchor-id="approche-1-famd-pcr">2. Approche 1: FAMD-PCR</h2>
<section id="famd-factor-analysis-of-mixed-data" class="level3">
<h3 class="anchored" data-anchor-id="famd-factor-analysis-of-mixed-data">2.1 FAMD (Factor Analysis of Mixed Data)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Séparer les variables explicatives de la cible</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>X_mixed <span class="ot">&lt;-</span> df_mixed[, <span class="sc">!</span><span class="fu">names</span>(df_mixed) <span class="sc">%in%</span> <span class="st">"Y"</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction FAMD simplifiée si FactoMineR n'est pas disponible</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>simplified_famd <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Séparer variables numériques et catégorielles</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  num_vars <span class="ot">&lt;-</span> data[, <span class="fu">sapply</span>(data, is.numeric)]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  cat_vars <span class="ot">&lt;-</span> data[, <span class="fu">sapply</span>(data, is.factor)]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardiser les variables numériques</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  num_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(num_vars)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Encoder les variables catégorielles (dummy coding)</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  cat_encoded <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(data)))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="fu">names</span>(cat_vars)) {</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    dummy_matrix <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> cat_vars[[col]]))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(dummy_matrix) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(col, <span class="st">"_"</span>, <span class="fu">colnames</span>(dummy_matrix))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    cat_encoded <span class="ot">&lt;-</span> <span class="fu">cbind</span>(cat_encoded, dummy_matrix)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combiner les données</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  combined_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(num_scaled, cat_encoded)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PCA sur les données combinées</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(combined_data, <span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculer la variance expliquée</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  variance_explained <span class="ot">&lt;-</span> (pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>(pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  cumvar_explained <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(variance_explained)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">ind =</span> <span class="fu">list</span>(<span class="at">coord =</span> pca_result<span class="sc">$</span>x),</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">eig =</span> <span class="fu">cbind</span>(<span class="at">eigenvalue =</span> pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">variance_percent =</span> variance_explained,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">cumulative_variance =</span> cumvar_explained),</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">combined_data =</span> combined_data</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer FAMD</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (use_factominer) {</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Utilisation de FactoMineR pour FAMD...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identifier les indices des variables catégorielles</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>  cat_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(X_mixed, is.factor))</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Variables catégorielles aux positions:"</span>, cat_indices, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  famd_result <span class="ot">&lt;-</span> <span class="fu">FAMD</span>(X_mixed, </span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ncp =</span> <span class="fu">min</span>(<span class="dv">30</span>, n<span class="dv">-1</span>),  <span class="co"># Maximum 30 composantes ou n-1</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>                      <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Utilisation de l'implémentation FAMD simplifiée...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  famd_result <span class="ot">&lt;-</span> <span class="fu">simplified_famd</span>(X_mixed)</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Utilisation de FactoMineR pour FAMD...
Variables catégorielles aux positions: 51 52 53 54 55 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire la variance expliquée</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (use_factominer) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  variance_explained <span class="ot">&lt;-</span> famd_result<span class="sc">$</span>eig[,<span class="dv">2</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  cumvar_explained <span class="ot">&lt;-</span> famd_result<span class="sc">$</span>eig[,<span class="dv">3</span>]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  variance_explained <span class="ot">&lt;-</span> famd_result<span class="sc">$</span>eig[,<span class="dv">2</span>]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  cumvar_explained <span class="ot">&lt;-</span> famd_result<span class="sc">$</span>eig[,<span class="dv">3</span>]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variance expliquée par les 10 premières composantes FAMD:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variance expliquée par les 10 premières composantes FAMD:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(variance_explained[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> comp 1  comp 2  comp 3  comp 4  comp 5  comp 6  comp 7  comp 8  comp 9 comp 10 
   5.91    5.35    5.13    4.62    4.37    4.04    3.97    3.80    3.72    3.39 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Critère du coude pour choisir le nombre de composantes</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(variance_explained)), variance_explained[<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(variance_explained))], </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Scree Plot FAMD - Variance expliquée par composante"</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Composante"</span>, <span class="at">ylab =</span> <span class="st">"% Variance expliquée"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(variance_explained), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="comparaison_PCR_cat_vs_num_files/figure-html/famd_analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choisir le nombre de composantes (critère: variance cumulée &gt;= 80% ou coude)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ncomp_famd <span class="ot">&lt;-</span> <span class="fu">which</span>(cumvar_explained <span class="sc">&gt;=</span> <span class="dv">80</span>)[<span class="dv">1</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(ncomp_famd)) ncomp_famd <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">length</span>(variance_explained))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Nombre de composantes FAMD retenues:"</span>, ncomp_famd, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nombre de composantes FAMD retenues: 25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variance cumulée expliquée:"</span>, <span class="fu">round</span>(cumvar_explained[ncomp_famd], <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variance cumulée expliquée: 80.42 %</code></pre>
</div>
</div>
</section>
<section id="classification-avec-régression-logistique-sur-composantes-famd" class="level3">
<h3 class="anchored" data-anchor-id="classification-avec-régression-logistique-sur-composantes-famd">2.2 Classification avec régression logistique sur composantes FAMD</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraction des composantes FAMD</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>famd_components <span class="ot">&lt;-</span> famd_result<span class="sc">$</span>ind<span class="sc">$</span>coord[, <span class="dv">1</span><span class="sc">:</span>ncomp_famd]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(famd_components) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"FAMD_PC"</span>, <span class="dv">1</span><span class="sc">:</span>ncomp_famd)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du dataset pour la classification</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>famd_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(famd_components, <span class="at">Y =</span> df_mixed<span class="sc">$</span>Y)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction pour calculer les métriques de classification</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>calculate_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(predicted, actual) {</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Matrice de confusion</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  cm <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Predicted =</span> predicted, <span class="at">Actual =</span> actual)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Accuracy</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(cm)) <span class="sc">/</span> <span class="fu">sum</span>(cm)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sensitivité et spécificité (pour la classe AML)</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"AML"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"AML"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm)) {</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    tp <span class="ot">&lt;-</span> cm[<span class="st">"AML"</span>, <span class="st">"AML"</span>]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    tn <span class="ot">&lt;-</span> cm[<span class="st">"ALL"</span>, <span class="st">"ALL"</span>] </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    fp <span class="ot">&lt;-</span> cm[<span class="st">"AML"</span>, <span class="st">"ALL"</span>]</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> cm[<span class="st">"ALL"</span>, <span class="st">"AML"</span>]</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    sensitivity <span class="ot">&lt;-</span> tp <span class="sc">/</span> (tp <span class="sc">+</span> fn)  <span class="co"># Taux de vrais positifs</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    specificity <span class="ot">&lt;-</span> tn <span class="sc">/</span> (tn <span class="sc">+</span> fp)  <span class="co"># Taux de vrais négatifs</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    sensitivity <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    specificity <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">Accuracy =</span> accuracy, <span class="at">Sensitivity =</span> sensitivity, <span class="at">Specificity =</span> specificity))</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation croisée manuelle (10-fold)</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12311</span>)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>n_folds <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>fold_size <span class="ot">&lt;-</span> <span class="fu">floor</span>(n <span class="sc">/</span> n_folds)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Métriques pour stocker les résultats</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>famd_metrics <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_folds, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(famd_metrics) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Accuracy"</span>, <span class="st">"Sensitivity"</span>, <span class="st">"Specificity"</span>)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation croisée</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_folds) {</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indices du fold de test</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>  start_idx <span class="ot">&lt;-</span> (i<span class="dv">-1</span>) <span class="sc">*</span> fold_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>  end_idx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> n_folds, n, i <span class="sc">*</span> fold_size)</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>  test_indices <span class="ot">&lt;-</span> indices[start_idx<span class="sc">:</span>end_idx]</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Division train/test</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> famd_data[<span class="sc">-</span>test_indices, ]</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> famd_data[test_indices, ]</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Modèle de régression logistique</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>  famd_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prédictions</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>  pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(famd_model, test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>  pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"AML"</span>, <span class="st">"ALL"</span>)</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>  pred_class <span class="ot">&lt;-</span> <span class="fu">factor</span>(pred_class, <span class="at">levels =</span> <span class="fu">levels</span>(test_data<span class="sc">$</span>Y))</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcul des métriques</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>  famd_metrics[i, ] <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(pred_class, test_data<span class="sc">$</span>Y)</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultats moyens FAMD-PCR</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>famd_results <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(famd_metrics, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>famd_sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(famd_metrics, <span class="dv">2</span>, sd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== RÉSULTATS FAMD-PCR ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== RÉSULTATS FAMD-PCR ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Nombre de composantes FAMD utilisées:"</span>, ncomp_famd, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nombre de composantes FAMD utilisées: 25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Accuracy moyenne:"</span>, <span class="fu">round</span>(famd_results[<span class="st">"Accuracy"</span>], <span class="dv">3</span>), <span class="st">"±"</span>, <span class="fu">round</span>(famd_sd[<span class="st">"Accuracy"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy moyenne: 0.41 ± 0.211 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sensitivity moyenne:"</span>, <span class="fu">round</span>(famd_results[<span class="st">"Sensitivity"</span>], <span class="dv">3</span>), <span class="st">"±"</span>, <span class="fu">round</span>(famd_sd[<span class="st">"Sensitivity"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensitivity moyenne: 0.456 ± 0.243 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Specificity moyenne:"</span>, <span class="fu">round</span>(famd_results[<span class="st">"Specificity"</span>], <span class="dv">3</span>), <span class="st">"±"</span>, <span class="fu">round</span>(famd_sd[<span class="st">"Specificity"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Specificity moyenne: 0.275 ± 0.272 </code></pre>
</div>
</div>
</section>
</section>
<section id="approche-2-pcr-classique-avec-encodage-manuel" class="level2">
<h2 class="anchored" data-anchor-id="approche-2-pcr-classique-avec-encodage-manuel">3. Approche 2: PCR Classique avec encodage manuel</h2>
<section id="encodage-des-variables-catégorielles" class="level3">
<h3 class="anchored" data-anchor-id="encodage-des-variables-catégorielles">3.1 Encodage des variables catégorielles</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonction pour créer des variables dummy</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>create_dummies <span class="ot">&lt;-</span> <span class="cf">function</span>(data, target_col) {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Séparer les variables numériques et catégorielles</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  num_vars <span class="ot">&lt;-</span> data[, <span class="fu">sapply</span>(data, is.numeric)]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  cat_vars <span class="ot">&lt;-</span> data[, <span class="fu">sapply</span>(data, is.factor) <span class="sc">&amp;</span> <span class="fu">names</span>(data) <span class="sc">!=</span> target_col]</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  target_var <span class="ot">&lt;-</span> data[[target_col]]</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Encodage des variables catégorielles (sans la première modalité pour éviter colinéarité)</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  dummy_vars <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(data)))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="fu">names</span>(cat_vars)) {</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Créer des variables dummy</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    dummy_matrix <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> cat_vars[[col]]))</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(dummy_matrix) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(col, <span class="st">"_"</span>, <span class="fu">colnames</span>(dummy_matrix))</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enlever la première colonne pour éviter la colinéarité parfaite</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">ncol</span>(dummy_matrix) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>      dummy_matrix <span class="ot">&lt;-</span> dummy_matrix[, <span class="sc">-</span><span class="dv">1</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    dummy_vars <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dummy_vars, dummy_matrix)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Encodage de la variable cible</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  target_numeric <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(target_var <span class="sc">==</span> <span class="st">"AML"</span>)  <span class="co"># AML = 1, ALL = 0</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinaison finale</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">X_encoded =</span> <span class="fu">cbind</span>(num_vars, dummy_vars),</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_encoded =</span> target_numeric,</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_original =</span> target_var</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Application de l'encodage</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>encoded_data <span class="ot">&lt;-</span> <span class="fu">create_dummies</span>(df_mixed, <span class="st">"Y"</span>)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="ot">&lt;-</span> encoded_data<span class="sc">$</span>X_encoded</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>y_encoded <span class="ot">&lt;-</span> encoded_data<span class="sc">$</span>y_encoded</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>y_original <span class="ot">&lt;-</span> encoded_data<span class="sc">$</span>y_original</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dimensions après encodage:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dimensions après encodage:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"X encodé:"</span>, <span class="fu">dim</span>(X_encoded), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>X encodé: 72 59 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables créées par l'encodage:"</span>, <span class="fu">ncol</span>(X_encoded) <span class="sc">-</span> p_num, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables créées par l'encodage: 9 </code></pre>
</div>
</div>
</section>
<section id="pca-sur-les-données-encodées" class="level3">
<h3 class="anchored" data-anchor-id="pca-sur-les-données-encodées">3.2 PCA sur les données encodées</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA sur les données encodées</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Réalisation de l'ACP sur les données encodées...</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Réalisation de l'ACP sur les données encodées...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardisation et PCA</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(X_encoded)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(X_scaled, <span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance expliquée</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>pca_variance <span class="ot">&lt;-</span> (pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>(pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>pca_cumvar <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(pca_variance)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variance expliquée par les 10 premières composantes PCA:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variance expliquée par les 10 premières composantes PCA:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(pca_variance[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 5.83 5.59 5.11 4.75 4.61 4.23 3.94 3.84 3.54 3.52</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scree plot</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(pca_variance)), pca_variance[<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(pca_variance))], </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"red"</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Scree Plot PCA - Variance expliquée par composante"</span>, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Composante"</span>, <span class="at">ylab =</span> <span class="st">"% Variance expliquée"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(pca_variance), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="comparaison_PCR_cat_vs_num_files/figure-html/classical_pca-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choisir le nombre de composantes</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>ncomp_pca <span class="ot">&lt;-</span> <span class="fu">which</span>(pca_cumvar <span class="sc">&gt;=</span> <span class="dv">80</span>)[<span class="dv">1</span>]</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(ncomp_pca)) ncomp_pca <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">length</span>(pca_variance))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Nombre de composantes PCA retenues:"</span>, ncomp_pca, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nombre de composantes PCA retenues: 25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variance cumulée expliquée:"</span>, <span class="fu">round</span>(pca_cumvar[ncomp_pca], <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variance cumulée expliquée: 81.1 %</code></pre>
</div>
</div>
</section>
<section id="classification-avec-régression-logistique-sur-composantes-pca" class="level3">
<h3 class="anchored" data-anchor-id="classification-avec-régression-logistique-sur-composantes-pca">3.3 Classification avec régression logistique sur composantes PCA</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraction des composantes PCA</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>pca_components <span class="ot">&lt;-</span> pca_result<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span>ncomp_pca]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pca_components) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"PCA_PC"</span>, <span class="dv">1</span><span class="sc">:</span>ncomp_pca)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du dataset pour la classification</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>pca_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_components, <span class="at">Y =</span> y_original)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation croisée (mêmes folds que FAMD pour comparaison équitable)</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>pca_metrics <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_folds, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pca_metrics) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Accuracy"</span>, <span class="st">"Sensitivity"</span>, <span class="st">"Specificity"</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation croisée</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_folds) {</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indices du fold de test (mêmes que pour FAMD)</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  start_idx <span class="ot">&lt;-</span> (i<span class="dv">-1</span>) <span class="sc">*</span> fold_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  end_idx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> n_folds, n, i <span class="sc">*</span> fold_size)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  test_indices <span class="ot">&lt;-</span> indices[start_idx<span class="sc">:</span>end_idx]</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Division train/test</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> pca_data[<span class="sc">-</span>test_indices, ]</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> pca_data[test_indices, ]</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Modèle de régression logistique</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  pca_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prédictions</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca_model, test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"AML"</span>, <span class="st">"ALL"</span>)</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  pred_class <span class="ot">&lt;-</span> <span class="fu">factor</span>(pred_class, <span class="at">levels =</span> <span class="fu">levels</span>(test_data<span class="sc">$</span>Y))</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcul des métriques</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>  pca_metrics[i, ] <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(pred_class, test_data<span class="sc">$</span>Y)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultats moyens PCR Classique</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>pca_results <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(pca_metrics, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>pca_sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(pca_metrics, <span class="dv">2</span>, sd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== RÉSULTATS PCR CLASSIQUE ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== RÉSULTATS PCR CLASSIQUE ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Nombre de composantes PCA utilisées:"</span>, ncomp_pca, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nombre de composantes PCA utilisées: 25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Accuracy moyenne:"</span>, <span class="fu">round</span>(pca_results[<span class="st">"Accuracy"</span>], <span class="dv">3</span>), <span class="st">"±"</span>, <span class="fu">round</span>(pca_sd[<span class="st">"Accuracy"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy moyenne: 0.47 ± 0.277 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sensitivity moyenne:"</span>, <span class="fu">round</span>(pca_results[<span class="st">"Sensitivity"</span>], <span class="dv">3</span>), <span class="st">"±"</span>, <span class="fu">round</span>(pca_sd[<span class="st">"Sensitivity"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensitivity moyenne: 0.559 ± 0.299 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Specificity moyenne:"</span>, <span class="fu">round</span>(pca_results[<span class="st">"Specificity"</span>], <span class="dv">3</span>), <span class="st">"±"</span>, <span class="fu">round</span>(pca_sd[<span class="st">"Specificity"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Specificity moyenne: 0.35 ± 0.346 </code></pre>
</div>
</div>
</section>
</section>
<section id="question-4-régression-sur-composantes-principales-pcr" class="level2">
<h2 class="anchored" data-anchor-id="question-4-régression-sur-composantes-principales-pcr">4. Question 4: Régression sur Composantes Principales (PCR)</h2>
<p>La Régression sur Composantes Principales (PCR) constitue une approche de réduction de dimension particulièrement adaptée aux problèmes de grande dimension. Cette section analyse en détail les deux approches PCR étudiées et les compare avec la régression Lasso, en s’appuyant sur les résultats obtenus dans ce rapport et les analyses précédentes.</p>
<section id="démarche-pcr-appliquée-aux-données-mixtes" class="level3">
<h3 class="anchored" data-anchor-id="démarche-pcr-appliquée-aux-données-mixtes">4.1 Démarche PCR appliquée aux données mixtes</h3>
<section id="principe-général-de-la-pcr" class="level4">
<h4 class="anchored" data-anchor-id="principe-général-de-la-pcr">4.1.1 Principe général de la PCR</h4>
<p>La PCR combine l’Analyse en Composantes Principales (ACP) avec une méthode de prédiction (régression ou classification). Contrairement aux méthodes de sélection de variables comme le Lasso, la PCR transforme l’ensemble des variables explicatives en un nombre réduit de composantes principales, puis utilise ces composantes comme nouvelles variables explicatives.</p>
<p><strong>Avantages théoriques :</strong></p>
<p>- Réduction drastique de la dimensionnalité tout en conservant l’information essentielle</p>
<p>- Stabilité numérique face aux problèmes de colinéarité</p>
<p>- Utilisation de toutes les variables originales dans la construction des composantes</p>
</section>
<section id="famd-pcr-approche-spécialisée-pour-données-mixtes" class="level4">
<h4 class="anchored" data-anchor-id="famd-pcr-approche-spécialisée-pour-données-mixtes">4.1.2 FAMD-PCR : Approche spécialisée pour données mixtes</h4>
<p>L’approche <strong>FAMD-PCR</strong> utilise l’Analyse Factorielle de Données Mixtes (FAMD) pour traiter simultanément variables numériques et catégorielles :</p>
<ul>
<li><strong>Préservation de la nature des variables</strong> : Contrairement à un encodage dummy classique, FAMD respecte la distinction entre types de variables</li>
<li><strong>Réduction naturelle</strong> : Dans notre étude, passage de 55 variables originales (50 numériques + 5 catégorielles) à 25 composantes principales</li>
<li><strong>Taux de réduction</strong> : 54.5% de réduction dimensionnelle</li>
<li><strong>Composantes optimales</strong> : 25 composantes retenues selon le critère de variance cumulée ≥ 80%</li>
</ul>
</section>
<section id="pcr-classique-approche-par-encodage-manuel" class="level4">
<h4 class="anchored" data-anchor-id="pcr-classique-approche-par-encodage-manuel">4.1.3 PCR Classique : Approche par encodage manuel</h4>
<p>La <strong>PCR Classique</strong> procède par encodage préalable des variables catégorielles :</p>
<ul>
<li><strong>Encodage dummy</strong> : Transformation des 5 variables catégorielles en variables binaires</li>
<li><strong>Augmentation dimensionnelle</strong> : Passage de 55 à plus de 60 variables après encodage</li>
<li><strong>ACP standard</strong> : Application d’une ACP classique sur l’ensemble des variables numériques</li>
<li><strong>Mêmes composantes</strong> : 25 composantes principales retenues pour comparaison équitable</li>
</ul>
</section>
</section>
<section id="résultats-et-comparaison-chiffrée-avec-le-lasso" class="level3">
<h3 class="anchored" data-anchor-id="résultats-et-comparaison-chiffrée-avec-le-lasso">4.2 Résultats et comparaison chiffrée avec le Lasso</h3>
<section id="performances-des-approches-pcr" class="level4">
<h4 class="anchored" data-anchor-id="performances-des-approches-pcr">4.2.1 Performances des approches PCR</h4>
<p><strong>FAMD-PCR :</strong></p>
<p>- <strong>Accuracy</strong> : 0.41 ± 0.211 (41% de précision moyenne)</p>
<ul>
<li><p><strong>Sensibilité</strong> : 0.456 ± 0.243 (45.6% de détection des cas positifs)</p></li>
<li><p><strong>Spécificité</strong> : 0.275 ± 0.272 (27.5% de détection des cas négatifs)</p></li>
</ul>
<p>- <strong>Stabilité</strong> : Écart-type de l’accuracy = 0.211</p>
<p><strong>PCR Classique :</strong></p>
<ul>
<li><strong>Accuracy</strong> : 0.47 ± 0.277 (47% de précision moyenne)</li>
</ul>
<p>- <strong>Sensibilité</strong> : 0.559 ± 0.299 (55.9% de détection des cas positifs)</p>
<p>- <strong>Spécificité</strong> : 0.35 ± 0.346 (35% de détection des cas négatifs)</p>
<p>- <strong>Stabilité</strong> : Écart-type de l’accuracy = 0.277</p>
</section>
<section id="comparaison-avec-les-résultats-lasso-daprès-les-analyses-précédentes" class="level4">
<h4 class="anchored" data-anchor-id="comparaison-avec-les-résultats-lasso-daprès-les-analyses-précédentes">4.2.2 Comparaison avec les résultats Lasso (d’après les analyses précédentes)</h4>
<p>D’après les résultats du rapport principal sur données de grande dimension (1000 variables) :</p>
<p><strong>Régression Lasso :</strong></p>
<p>- <strong>Variables sélectionnées</strong> : 0 sur 1000 variables (sélection nulle)</p>
<p>- <strong>Lambda optimal</strong> : 0.18 (régularisation très forte)</p>
<p>- <strong>Interprétabilité</strong> : Maximale en théorie, mais aucune variable retenue</p>
<p>- <strong>Performance</strong> : Échec de la classification par sélection stricte</p>
<p><strong>PCR sur données de grande dimension :</strong> - <strong>Composantes utilisées</strong> : 1 composante optimale sur 71 possibles - <strong>Réduction de dimension</strong> : 99.9% de réduction (de 1000 à 1 variable latente) - <strong>Accuracy</strong> : 61.11% de précision - <strong>Approche</strong> : Réussite par transformation douce</p>
</section>
<section id="analyse-comparative-des-performances" class="level4">
<h4 class="anchored" data-anchor-id="analyse-comparative-des-performances">4.2.3 Analyse comparative des performances</h4>
<ol type="1">
<li><strong>Efficacité prédictive</strong> : PCR (61.11% sur grande dimension) &gt; PCR sur données mixtes (41-47%) &gt; Lasso (échec)</li>
<li><strong>Robustesse</strong> : PCR maintient des performances acceptables même quand Lasso échoue</li>
<li><strong>Stabilité</strong> : FAMD-PCR montre une meilleure stabilité (écart-type plus faible) que PCR Classique</li>
<li><strong>Dimension optimale</strong> : La PCR trouve systématiquement un compromis entre réduction et performance</li>
</ol>
</section>
</section>
<section id="différences-dapproche-fondamentale" class="level3">
<h3 class="anchored" data-anchor-id="différences-dapproche-fondamentale">4.3 Différences d’approche fondamentale</h3>
<section id="philosophie-de-sélection-vs-transformation" class="level4">
<h4 class="anchored" data-anchor-id="philosophie-de-sélection-vs-transformation">4.3.1 Philosophie de sélection vs transformation</h4>
<p><strong>Lasso - Sélection stricte :</strong> - Mécanisme : Pénalisation L1 conduisant à des coefficients exactement nuls - Résultat : Variables soit incluses (coefficient ≠ 0) soit exclues (coefficient = 0) - Avantage : Parcimonie et interprétabilité directe des variables retenues - Limite : Peut éliminer toutes les variables si aucune n’a d’effet individuel suffisant</p>
<p><strong>PCR - Transformation douce :</strong> - Mécanisme : Combinaisons linéaires de toutes les variables avec poids différents - Résultat : Toutes les variables contribuent aux composantes principales - Avantage : Capture des effets conjoints et des interactions subtiles - Limite : Perte de l’interprétabilité directe des variables individuelles</p>
</section>
<section id="gestion-de-la-dimension-et-de-la-complexité" class="level4">
<h4 class="anchored" data-anchor-id="gestion-de-la-dimension-et-de-la-complexité">4.3.2 Gestion de la dimension et de la complexité</h4>
<p><strong>Question de la haute dimension :</strong> - <strong>Lasso</strong> : Efficace quand quelques variables ont des effets forts et individualisables - <strong>PCR</strong> : Performante quand l’information est distribuée dans de nombreuses variables</p>
<p><strong>Gestion de la colinéarité :</strong> - <strong>Lasso</strong> : Peut arbitrairement choisir une variable parmi un groupe de variables corrélées - <strong>PCR</strong> : Combine naturellement les variables corrélées dans les premières composantes</p>
</section>
<section id="illustration-avec-nos-données" class="level4">
<h4 class="anchored" data-anchor-id="illustration-avec-nos-données">4.3.3 Illustration avec nos données</h4>
<p>Dans notre étude sur données mixtes : - <strong>Lasso aurait probablement échoué</strong> (par analogie avec l’étude principale) car les variables individuelles ont des effets faibles - <strong>PCR réussit</strong> en capturant 80% de la variance avec 25 composantes, permettant une classification avec ~45% d’accuracy - <strong>FAMD-PCR vs PCR Classique</strong> : Performances comparables mais approches différentes de la gestion des variables catégorielles</p>
</section>
</section>
<section id="que-perd-on-en-passant-des-variables-initiales-aux-composantes-principales" class="level3">
<h3 class="anchored" data-anchor-id="que-perd-on-en-passant-des-variables-initiales-aux-composantes-principales">4.4 Que perd-on en passant des variables initiales aux composantes principales ?</h3>
<section id="pertes-en-termes-dinterprétabilité" class="level4">
<h4 class="anchored" data-anchor-id="pertes-en-termes-dinterprétabilité">4.4.1 Pertes en termes d’interprétabilité</h4>
<p><strong>Perte de signification directe :</strong> - Une composante principale = combinaison linéaire de toutes les variables - Exemple : PC1 = 0.15×Num_1 + 0.08×Num_2 + … + 0.12×Cat_1_B + … - <strong>Difficulté</strong> : Identifier quelles variables originales impactent spécifiquement la prédiction</p>
<p><strong>Perte de sens métier :</strong> - Variables originales : signification concrète (âge, revenus, catégorie socio-professionnelle, etc.) - Composantes principales : constructions mathématiques abstraites sans sens physique - <strong>Impact</strong> : Communication difficile aux experts métier</p>
</section>
<section id="pertes-en-termes-de-parcimonie" class="level4">
<h4 class="anchored" data-anchor-id="pertes-en-termes-de-parcimonie">4.4.2 Pertes en termes de parcimonie</h4>
<p><strong>Absence de sélection :</strong> - Toutes les variables contribuent à chaque composante - Impossible d’identifier un sous-ensemble réduit de variables “importantes” - <strong>Contraste avec Lasso</strong> : Qui peut éliminer complètement les variables non informatives</p>
</section>
<section id="ce-que-lon-gagne-en-compensation" class="level4">
<h4 class="anchored" data-anchor-id="ce-que-lon-gagne-en-compensation">4.4.3 Ce que l’on gagne en compensation</h4>
<p><strong>Stabilité numérique :</strong> - Orthogonalité des composantes principales élimine les problèmes de colinéarité - Robustesse face aux données bruitées</p>
<p><strong>Capture de structures complexes :</strong> - Détection d’interactions et d’effets conjoints non linéaires - Préservation de l’information distribuée dans l’ensemble des variables</p>
<p><strong>Performance en haute dimension :</strong> - Dans notre étude : PCR réussit (61.11%) là où Lasso échoue (0 variable) - Particulièrement adapté aux domaines comme la génomique, l’analyse d’images, etc.</p>
</section>
</section>
<section id="conclusion-et-recommandations" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-et-recommandations">4.5 Conclusion et recommandations</h3>
<section id="synthèse-des-avantages-et-limites" class="level4">
<h4 class="anchored" data-anchor-id="synthèse-des-avantages-et-limites">4.5.1 Synthèse des avantages et limites</h4>
<p><strong>Avantages de la PCR :</strong> - <strong>Robustesse</strong> : Fonctionne même quand les méthodes de sélection échouent - <strong>Exhaustivité</strong> : Utilise toute l’information disponible dans les données - <strong>Stabilité</strong> : Résultats reproductibles et numériquement stables - <strong>Flexibilité</strong> : FAMD-PCR s’adapte naturellement aux données mixtes</p>
<p><strong>Limites de la PCR :</strong> - <strong>Interprétabilité</strong> : Composantes abstraites difficiles à expliquer - <strong>Parcimonie</strong> : Pas de réduction du nombre de variables à mesurer - <strong>Communication</strong> : Difficile de traduire les résultats en recommandations actionables</p>
</section>
<section id="recommandations-dusage" class="level4">
<h4 class="anchored" data-anchor-id="recommandations-dusage">4.5.2 Recommandations d’usage</h4>
<p><strong>Utiliser PCR quand :</strong> - Les données sont en très haute dimension (p &gt;&gt; n) - L’information est distribuée dans de nombreuses variables - La stabilité numérique est prioritaire - Les méthodes de sélection (Lasso, tests univariés) échouent - Le contexte permet des variables latentes (finance quantitative, bioinformatique)</p>
<p><strong>Préférer Lasso quand :</strong> - L’interprétabilité directe est cruciale - Le budget limite le nombre de variables mesurables - Quelques variables ont des effets forts et individualisables - Le domaine nécessite des recommandations actionables précises</p>
<p><strong>Compromis FAMD-PCR vs PCR Classique :</strong> - <strong>FAMD-PCR</strong> : Données avec forte proportion de variables catégorielles, besoin de préserver la nature des variables - <strong>PCR Classique</strong> : Compatibilité avec des pipelines existants, majorité de variables numériques</p>
</section>
<section id="perspective-méthodologique" class="level4">
<h4 class="anchored" data-anchor-id="perspective-méthodologique">4.5.3 Perspective méthodologique</h4>
<p>La comparaison entre PCR et Lasso illustre un débat fondamental en apprentissage statistique : <strong>sélection vs transformation</strong>. Nos résultats suggèrent que dans les contextes de haute dimension avec signal distribué, les approches de transformation (PCR, PLS) peuvent surpasser les méthodes de sélection stricte. Cette observation est particulièrement pertinente pour les domaines émergents où l’on dispose de nombreuses mesures potentiellement informatives mais individuellement faibles.</p>
</section>
</section>
</section>
<section id="comparaison-technique-des-deux-approches-pcr" class="level2">
<h2 class="anchored" data-anchor-id="comparaison-technique-des-deux-approches-pcr">5. Comparaison technique des deux approches PCR</h2>
<p>Après avoir analysé le positionnement théorique de la PCR face au Lasso, nous nous concentrons maintenant sur la comparaison pratique entre les deux implémentations de PCR étudiées : FAMD-PCR et PCR Classique. Cette analyse technique détaille leurs performances relatives et leurs spécificités d’implémentation.</p>
<section id="tableau-comparatif-des-performances" class="level3">
<h3 class="anchored" data-anchor-id="tableau-comparatif-des-performances">5.1 Tableau comparatif des performances</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du tableau de comparaison</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Methode =</span> <span class="fu">c</span>(<span class="st">"FAMD-PCR"</span>, <span class="st">"PCR Classique"</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nb_Composantes =</span> <span class="fu">c</span>(ncomp_famd, ncomp_pca),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Accuracy =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="fu">round</span>(famd_results[<span class="st">"Accuracy"</span>], <span class="dv">3</span>), <span class="st">" ± "</span>, <span class="fu">round</span>(famd_sd[<span class="st">"Accuracy"</span>], <span class="dv">3</span>)),</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">paste0</span>(<span class="fu">round</span>(pca_results[<span class="st">"Accuracy"</span>], <span class="dv">3</span>), <span class="st">" ± "</span>, <span class="fu">round</span>(pca_sd[<span class="st">"Accuracy"</span>], <span class="dv">3</span>))),</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sensitivity =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="fu">round</span>(famd_results[<span class="st">"Sensitivity"</span>], <span class="dv">3</span>), <span class="st">" ± "</span>, <span class="fu">round</span>(famd_sd[<span class="st">"Sensitivity"</span>], <span class="dv">3</span>)),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">paste0</span>(<span class="fu">round</span>(pca_results[<span class="st">"Sensitivity"</span>], <span class="dv">3</span>), <span class="st">" ± "</span>, <span class="fu">round</span>(pca_sd[<span class="st">"Sensitivity"</span>], <span class="dv">3</span>))),</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Specificity =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="fu">round</span>(famd_results[<span class="st">"Specificity"</span>], <span class="dv">3</span>), <span class="st">" ± "</span>, <span class="fu">round</span>(famd_sd[<span class="st">"Specificity"</span>], <span class="dv">3</span>)),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">paste0</span>(<span class="fu">round</span>(pca_results[<span class="st">"Specificity"</span>], <span class="dv">3</span>), <span class="st">" ± "</span>, <span class="fu">round</span>(pca_sd[<span class="st">"Specificity"</span>], <span class="dv">3</span>)))</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== TABLEAU COMPARATIF ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== TABLEAU COMPARATIF ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparison_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Methode Nb_Composantes     Accuracy   Sensitivity   Specificity
comp 25      FAMD-PCR             25 0.41 ± 0.211 0.456 ± 0.243 0.275 ± 0.272
        PCR Classique             25 0.47 ± 0.277 0.559 ± 0.299  0.35 ± 0.346</code></pre>
</div>
</div>
</section>
<section id="visualisations-comparatives" class="level3">
<h3 class="anchored" data-anchor-id="visualisations-comparatives">5.2 Visualisations comparatives</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphique de comparaison des Scree plots</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Scree plot FAMD</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">length</span>(variance_explained)), variance_explained[<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">length</span>(variance_explained))], </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">main =</span> <span class="st">"FAMD - Variance expliquée"</span>, </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Composante"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(variance_explained[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> ncomp_famd, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Scree plot PCA</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">length</span>(pca_variance)), pca_variance[<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">length</span>(pca_variance))], </span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">main =</span> <span class="st">"PCA - Variance expliquée"</span>, </span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Composante"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(pca_variance[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> ncomp_pca, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="comparaison_PCR_cat_vs_num_files/figure-html/comparison_plots-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots de comparaison des performances (version simplifiée)</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphique des performances en barres</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>performance_means <span class="ot">&lt;-</span> <span class="fu">c</span>(famd_results[<span class="st">"Accuracy"</span>], pca_results[<span class="st">"Accuracy"</span>])</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>performance_sds <span class="ot">&lt;-</span> <span class="fu">c</span>(famd_sd[<span class="st">"Accuracy"</span>], pca_sd[<span class="st">"Accuracy"</span>])</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>method_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FAMD-PCR"</span>, <span class="st">"PCR Classique"</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(performance_means, <span class="at">names.arg =</span> method_names, </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Comparaison des performances (Accuracy)"</span>,</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Accuracy"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"lightcoral"</span>))</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter les barres d'erreur</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="at">x0 =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">1.9</span>), <span class="at">y0 =</span> performance_means <span class="sc">-</span> performance_sds,</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x1 =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">1.9</span>), <span class="at">y1 =</span> performance_means <span class="sc">+</span> performance_sds,</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">code =</span> <span class="dv">3</span>, <span class="at">length =</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="comparaison_PCR_cat_vs_num_files/figure-html/comparison_plots-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="analyse-de-la-sparsité-et-des-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="analyse-de-la-sparsité-et-des-coefficients">5.3 Analyse de la sparsité et des coefficients</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyse de la complexité des modèles</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour FAMD-PCR: analyser les contributions des variables aux composantes</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== ANALYSE DE LA COMPLEXITÉ ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== ANALYSE DE LA COMPLEXITÉ ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"FAMD-PCR:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>FAMD-PCR:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Variables numériques impliquées:"</span>, p_num, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Variables numériques impliquées: 50 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Variables catégorielles impliquées:"</span>, p_cat, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Variables catégorielles impliquées: 5 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Total variables originales:"</span>, p_num <span class="sc">+</span> p_cat, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Total variables originales: 55 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Composantes utilisées:"</span>, ncomp_famd, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Composantes utilisées: 25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Réduction de dimension:"</span>, <span class="fu">round</span>((<span class="dv">1</span> <span class="sc">-</span> ncomp_famd<span class="sc">/</span>(p_num <span class="sc">+</span> p_cat)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Réduction de dimension: 54.5 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"PCR Classique:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>PCR Classique:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Variables après encodage:"</span>, <span class="fu">ncol</span>(X_encoded), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Variables après encodage: 59 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Variables catégorielles encodées:"</span>, <span class="fu">ncol</span>(X_encoded) <span class="sc">-</span> p_num, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Variables catégorielles encodées: 9 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Composantes utilisées:"</span>, ncomp_pca, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Composantes utilisées: 25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Réduction de dimension:"</span>, <span class="fu">round</span>((<span class="dv">1</span> <span class="sc">-</span> ncomp_pca<span class="sc">/</span><span class="fu">ncol</span>(X_encoded)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Réduction de dimension: 57.6 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Efficacité de la réduction</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Efficacité de la réduction dimensionnelle:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Efficacité de la réduction dimensionnelle:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- FAMD-PCR: de"</span>, p_num <span class="sc">+</span> p_cat, <span class="st">"variables à"</span>, ncomp_famd, <span class="st">"composantes</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- FAMD-PCR: de 55 variables à 25 composantes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- PCR Classique: de"</span>, <span class="fu">ncol</span>(X_encoded), <span class="st">"variables à"</span>, ncomp_pca, <span class="st">"composantes</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- PCR Classique: de 59 variables à 25 composantes</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusions-et-recommandations" class="level2">
<h2 class="anchored" data-anchor-id="conclusions-et-recommandations">6. Conclusions et recommandations</h2>
<section id="analyse-des-résultats" class="level3">
<h3 class="anchored" data-anchor-id="analyse-des-résultats">6.1 Analyse des résultats</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== SYNTHÈSE COMPARATIVE ===</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== SYNTHÈSE COMPARATIVE ===</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaison directe des performances moyennes</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Performance comparative:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Performance comparative:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>better_method <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(famd_results[<span class="st">"Accuracy"</span>] <span class="sc">&gt;</span> pca_results[<span class="st">"Accuracy"</span>], <span class="st">"FAMD-PCR"</span>, <span class="st">"PCR Classique"</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓"</span>, better_method, <span class="st">"présente une meilleure accuracy moyenne</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ PCR Classique présente une meilleure accuracy moyenne</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaison du nombre de composantes</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Efficacité de la réduction dimensionnelle:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Efficacité de la réduction dimensionnelle:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (ncomp_famd <span class="sc">&lt;</span> ncomp_pca) {</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ FAMD-PCR utilise moins de composantes ("</span>, ncomp_famd, <span class="st">"vs"</span>, ncomp_pca, <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (ncomp_famd <span class="sc">&gt;</span> ncomp_pca) {</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✓ PCR Classique utilise moins de composantes ("</span>, ncomp_pca, <span class="st">"vs"</span>, ncomp_famd, <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"= Les deux méthodes utilisent le même nombre de composantes ("</span>, ncomp_famd, <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>= Les deux méthodes utilisent le même nombre de composantes ( 25 )</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Complexité computationnelle:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Complexité computationnelle:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- FAMD-PCR traite directement les données mixtes sans préprocessing lourd</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- FAMD-PCR traite directement les données mixtes sans préprocessing lourd</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- PCR Classique nécessite un encodage dummy qui augmente la dimensionnalité de"</span>, </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ncol</span>(X_encoded) <span class="sc">-</span> (p_num <span class="sc">+</span> p_cat), <span class="st">"variables</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- PCR Classique nécessite un encodage dummy qui augmente la dimensionnalité de 4 variables</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Gestion des données mixtes:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Gestion des données mixtes:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- FAMD-PCR: méthode spécialisée qui préserve la nature des types de variables</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- FAMD-PCR: méthode spécialisée qui préserve la nature des types de variables</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- PCR Classique: transformation uniformisante vers le numérique</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- PCR Classique: transformation uniformisante vers le numérique</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Stabilité des résultats:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Stabilité des résultats:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- FAMD-PCR: écart-type accuracy ="</span>, <span class="fu">round</span>(famd_sd[<span class="st">"Accuracy"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- FAMD-PCR: écart-type accuracy = 0.211 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- PCR Classique: écart-type accuracy ="</span>, <span class="fu">round</span>(pca_sd[<span class="st">"Accuracy"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- PCR Classique: écart-type accuracy = 0.277 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>more_stable <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(famd_sd[<span class="st">"Accuracy"</span>] <span class="sc">&lt;</span> pca_sd[<span class="st">"Accuracy"</span>], <span class="st">"FAMD-PCR"</span>, <span class="st">"PCR Classique"</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓"</span>, more_stable, <span class="st">"montre une meilleure stabilité</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ FAMD-PCR montre une meilleure stabilité</code></pre>
</div>
</div>
</section>
<section id="recommandations-pratiques" class="level3">
<h3 class="anchored" data-anchor-id="recommandations-pratiques">6.2 Recommandations pratiques</h3>
<p><strong>Quand utiliser FAMD-PCR:</strong> - Données avec un mélange significatif de variables numériques et catégorielles - Besoin de préserver la nature catégorielle des variables dans l’analyse - Situations où l’interprétation des composantes en termes de types de variables est importante - Contextes où la réduction de dimension doit tenir compte naturellement des deux types de données</p>
<p><strong>Quand utiliser PCR Classique:</strong> - Majorité de variables numériques avec quelques variables catégorielles - Variables catégorielles avec peu de modalités (pour éviter l’explosion dimensionnelle) - Compatibilité requise avec des pipelines de ML existants basés sur des données numériques - Situations où la performance prédictive prime sur l’interprétabilité</p>
<p><strong>Points clés de la comparaison:</strong></p>
<ol type="1">
<li><p><strong>Préprocessing:</strong> FAMD-PCR traite directement les données mixtes, tandis que PCR Classique nécessite un encodage manuel préalable</p></li>
<li><p><strong>Dimensionnalité:</strong> L’encodage dummy du PCR Classique peut augmenter significativement le nombre de variables</p></li>
<li><p><strong>Interprétabilité:</strong> FAMD-PCR conserve la distinction entre types de variables dans les composantes</p></li>
<li><p><strong>Performance:</strong> Les deux méthodes montrent des performances comparables dans notre étude</p></li>
</ol>
<p><strong>Limites de l’étude:</strong> - Jeu de données simulé relativement petit (n=72) - Nombre limité de variables catégorielles (5) - Validation sur un seul type de problème (classification binaire) - Absence de données réelles avec structures complexes</p>
<p><strong>Conclusion:</strong> Les deux approches constituent des alternatives viables pour la classification de données mixtes via PCR. Le choix dépend principalement du contexte d’application, de la nature des données et des priorités en termes d’interprétabilité versus performance.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>